# OpenInstrument

**ä¼ä¸šçº§ Web ç«¯è¿‡ç¨‹ä»ªè¡¨å·¥ç¨‹è®¾è®¡ç³»ç»Ÿ** - å¯¹æ ‡ Hexagon SmartPlant Instrumentation (SPI)

[![Version](https://img.shields.io/badge/version-0.2.17-blue.svg)]()
[![Django](https://img.shields.io/badge/Django-5.2-green.svg)]()
[![React](https://img.shields.io/badge/React-19-blue.svg)]()
[![License](https://img.shields.io/badge/license-MIT-green.svg)]()

---

## ğŸ“‹ é¡¹ç›®æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [SPECIFICATION.md](docs/SPECIFICATION.md) | è½¯ä»¶è§„æ ¼è¯´æ˜ä¹¦ - æ¶æ„ã€æ•°æ®æ¨¡å‹ã€API è§„æ ¼ |
| [IMPLEMENTATION.md](docs/IMPLEMENTATION.md) | å®ç°çŠ¶æ€è·Ÿè¸ª - åŠŸèƒ½å®Œæˆæƒ…å†µ |
| [PRD.md](docs/PRD.md) | äº§å“éœ€æ±‚æ–‡æ¡£ |

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ª**ä¼ä¸šçº§ã€å¤šç§Ÿæˆ·ã€æ”¯æŒå¹¶å‘åä½œ**çš„è¿‡ç¨‹ä»ªè¡¨å·¥ç¨‹è®¾è®¡ç³»ç»Ÿï¼Œå…¨é¢å¯¹æ ‡ SmartPlant Instrumentation (SPI) åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ

| åŠŸèƒ½æ¨¡å— | è¯´æ˜ |
|----------|------|
| **é¡¹ç›®å±‚çº§ç®¡ç†** | Project â†’ Client â†’ Site â†’ Plant â†’ Area â†’ Unit å®Œæ•´å±‚çº§ |
| **ä»ªè¡¨ç´¢å¼•è¡¨** | é«˜æ€§èƒ½æ•°æ®ç½‘æ ¼ï¼Œæ”¯æŒ 10,000+ ä½å·ï¼Œè™šæ‹Ÿæ»šåŠ¨ |
| **è§„æ ¼ä¹¦ç®¡ç†** | åŠ¨æ€è¡¨å•ï¼ŒJSON Schema æ¨¡æ¿ï¼Œç‰ˆæœ¬æ§åˆ¶ |
| **å›è·¯ç®¡ç†** | æ§åˆ¶å›è·¯å®šä¹‰ï¼Œè‡ªåŠ¨ç”Ÿæˆå›è·¯å›¾ |
| **æ¥çº¿ç®¡ç†** | I/O é€šé“åˆ†é…ï¼Œç«¯å­åˆ†é…ï¼Œç”µç¼†ç®¡ç† |
| **å›è·¯å›¾ç”Ÿæˆ** | æ•°æ®é©±åŠ¨è‡ªåŠ¨ç”Ÿæˆï¼Œæ”¯æŒ DWG/DXF/PDF å¯¼å‡º |
| **P&ID æ•°æ®é›†æˆ** | æ”¯æŒ SmartPlant/AVEVA/AutoCAD P&ID æ•°æ®å¯¼å…¥ |
| **å˜æ›´è¿½è¸ª** | å­—æ®µçº§å˜æ›´æ ‡è®°ï¼Œç‰ˆæœ¬å¯¹æ¯”ï¼Œå®¡è®¡æ—¥å¿— |

---

## ğŸ—ï¸ åŠŸèƒ½æ¨¡å—è¯¦ç»†è¯´æ˜

### 1. é¡¹ç›®å±‚çº§ç®¡ç† (Administration)

```
Project (å·¥ç¨‹é¡¹ç›® - é¡¶å±‚å…¥å£ï¼Œç”¨ Project No. ä½œä¸º ID)
â””â”€â”€ Client (å®¢æˆ·/ä¸šä¸»)
    â””â”€â”€ Site(s) (å‚åŒºï¼Œæ”¯æŒå¤šä¸ª)
        â””â”€â”€ Plant(s) (å·¥å‚/è£…ç½®)
            â””â”€â”€ Area(s) (å·¥è‰ºåŒºåŸŸ)
                â””â”€â”€ Unit(s) (å·¥è‰ºå•å…ƒ)
                    â””â”€â”€ Tags, Loops, Wiring...
```

- **çµæ´»çš„å±‚çº§é…ç½®**: æ”¯æŒ standard/simple/custom æ¨¡æ¿
- **å¤šç§Ÿæˆ·æ”¯æŒ**: Organization çº§åˆ«æ•°æ®éš”ç¦» (SaaS æ¨¡å¼)
- **RBAC æƒé™æ§åˆ¶**: 5 çº§è§’è‰²å±‚çº§
  - Administrator: ç³»ç»Ÿæœ€é«˜æƒé™
  - Project Engineer: é¡¹ç›®å…¨ä¸“ä¸šæƒé™
  - Instrumentation/Process/Mechanical Engineer: ä¸“ä¸šæ•°æ®æƒé™
  - Guest: åªè¯»æƒé™
- **å·¥ç¨‹é¡¹ç›®ç»„ (Project Task Force)**: é¡¹ç›®ç»„åˆ›å»ºã€æˆå‘˜ç®¡ç†ã€æƒé™éš”ç¦»

### 2. ä»ªè¡¨ç´¢å¼•è¡¨ (Instrument Index)

- **é«˜æ€§èƒ½æ•°æ®ç½‘æ ¼**: TanStack Tableï¼Œè™šæ‹Ÿæ»šåŠ¨æ”¯æŒ 10,000+ è¡Œ
- **ä»ªè¡¨ç±»å‹åº“**: JSON Schema å®šä¹‰è§„æ ¼æ¨¡æ¿
- **å‘½åè§„åˆ™**: æ­£åˆ™è¡¨è¾¾å¼å¼ºåˆ¶è§„èŒƒä½å·æ ¼å¼
  - 6 ç§å±‚çº§æ ¼å¼: Site-Plant-Area-Unit-Function-Sequence ç­‰
  - 7 ç§é¢„è®¾æ¨¡æ¿: ISA-5.1, å®Œæ•´å±‚çº§, ç®€åŒ–æ ¼å¼ç­‰
  - è‡ªåŠ¨ç”Ÿæˆä½å·åŠŸèƒ½
- **å…¸å‹å›è·¯å¤åˆ¶ (Typical Loop)**: ä¸€é”®ç”Ÿæˆå¤šç»„å®ä½“æ•°æ®
- **æ‰¹é‡æ“ä½œ**: æ‰¹é‡ç¼–è¾‘ã€å¯¼å…¥ã€å¯¼å‡º (Excel)
- **å±‚çº§ä¸Šä¸‹æ–‡è¿‡æ»¤**: æŒ‰ Unit/Area/Plant è‡ªåŠ¨è¿‡æ»¤æ•°æ®

### 3. è§„æ ¼ä¹¦ç®¡ç† (Specifications)

- **åŠ¨æ€è¡¨å•**: åŸºäº InstrumentType.schema_template è‡ªåŠ¨ç”Ÿæˆ
- **ç‰ˆæœ¬æ§åˆ¶**: å­—æ®µçº§å˜æ›´è¿½è¸ªï¼Œç‰ˆæœ¬å¯¹æ¯”
- **PDF å¯¼å‡º**: æ ‡å‡†è§„æ ¼ä¹¦æ ¼å¼è¾“å‡º
- **External Editor**: ä¾›åº”å•†æ•°æ®äº¤æ¢ (.oisf æ ¼å¼)

### 4. æ¥çº¿ç®¡ç† (Wiring)

- **I/O é€šé“åˆ†é…**: æ”¯æŒ AI/AO/DI/DO å¡ä»¶é€šé“åˆ†é…
- **æ¥çº¿ç®±ç«¯å­åˆ†é…**: ç«¯å­æ’ç®¡ç†ï¼Œè·³çº¿é…ç½®
- **æ¥çº¿åˆ¶å¼æ”¯æŒ**: 2-Wire/3-Wire/4-Wire/6-Wire
- **ä¾›ç”µç±»å‹**: Loop-Powered, 24VDC, 110VAC, 230VAC
- **RIO ç›˜æŸœç®¡ç†**: ç°åœº I/O ç›˜æŸœï¼ŒFieldbus é€šè®¯
- **ç”µç¼†ç®¡ç†**: ç”µç¼†è§„æ ¼ã€è·¯ç”±ã€æ–½å·¥è¿›åº¦è·Ÿè¸ª

**æ”¯æŒçš„ä¿¡å·è·¯å¾„:**
```
è·¯å¾„ 1: Tag â†’ JB â†’ Main Cabinet/DCS (é›†ä¸­å¼)
è·¯å¾„ 2: Tag â†’ RIO Panel â†’ DCS (åˆ†å¸ƒå¼)
è·¯å¾„ 3: Tag â†’ JB â†’ RIO Panel â†’ DCS (å¤§å‹é¡¹ç›®)
```

### 5. å›è·¯å›¾ç”Ÿæˆ (Loop Drawings)

- **æ•°æ®é©±åŠ¨**: åŸºäº Tagã€Loopã€Wiring æ•°æ®è‡ªåŠ¨ç”Ÿæˆ
- **React Flow**: å¯è§†åŒ–å›è·¯å›¾ç¼–è¾‘å’Œå±•ç¤º
- **ç¬¦å·åº“**: å¯å®šåˆ¶çš„ä»ªè¡¨ç¬¦å·åº“
- **å¯¼å‡ºæ ¼å¼**: PDF, DWG, DXF, SVG, PNG

### 6. Cable Schedule (ç”µç¼†æ¸…å•è¡¨)

- **ç«¯åˆ°ç«¯è·¯å¾„**: å®Œæ•´çš„ç”µç¼†è·¯å¾„è¿½è¸ª
- **è§„æ ¼ç®¡ç†**: ç”µç¼†ç±»å‹ã€èŠ¯æ•°ã€å±è”½ã€é“ è£…
- **æ–½å·¥è·Ÿè¸ª**: å®‰è£…çŠ¶æ€ã€æµ‹è¯•ç»“æœã€è°ƒè¯•è¿›åº¦
- **æŠ¥è¡¨å¯¼å‡º**: Excel/PDF æ ¼å¼

### 7. P&ID æ•°æ®é›†æˆ

- **æ”¯æŒçš„è½¯ä»¶**: SmartPlant P&ID, AVEVA E3D, AutoCAD P&ID
- **å¯¼å…¥æ ¼å¼**: XML, Excel, CSV, æ•°æ®åº“ç›´è¿
- **å­—æ®µæ˜ å°„**: å¯è§†åŒ–å­—æ®µæ˜ å°„é…ç½®
- **å¢é‡åŒæ­¥**: å®šæ—¶è‡ªåŠ¨åŒæ­¥ï¼Œå·®å¼‚æ£€æµ‹

### 8. ç‰ˆæœ¬æ§åˆ¶ä¸å®¡è®¡

- **å˜æ›´è¿½è¸ª**: å­—æ®µçº§å˜æ›´è®°å½• (old_value â†’ new_value)
- **ç‰ˆæœ¬å¯¹æ¯”**: å¯è§†åŒ–å·®å¼‚æ˜¾ç¤º
- **å®¡è®¡æ—¥å¿—**: Who/When/What å®Œæ•´è®°å½•
- **å˜æ›´å®¡æ‰¹**: å¯é€‰çš„å˜æ›´å®¡æ‰¹æµç¨‹

### 9. å›½é™…åŒ– (i18n)

- **ä¸»è¯­è¨€**: English (è‹±è¯­) - é»˜è®¤è¯­è¨€ï¼Œçº¯è‹±è¯­ç•Œé¢
- **12 ç§è¯­è¨€æ”¯æŒ**:
  - ä¸œäºš: ç®€ä½“ä¸­æ–‡, ç¹é«”ä¸­æ–‡, æ—¥æœ¬èª, í•œêµ­ì–´
  - æ¬§æ´²: FranÃ§ais, EspaÃ±ol, Italiano, Deutsch, Ğ ÑƒÑÑĞºĞ¸Ğ¹
  - RTL: Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (é˜¿æ‹‰ä¼¯è¯­), ×¢×‘×¨×™×ª (å¸Œä¼¯æ¥è¯­)
- **RTL å¸ƒå±€æ”¯æŒ**: é˜¿æ‹‰ä¼¯è¯­/å¸Œä¼¯æ¥è¯­è‡ªåŠ¨åˆ‡æ¢å¸ƒå±€æ–¹å‘
- **å³æ—¶åˆ‡æ¢**: è¯­è¨€åˆ‡æ¢åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€åˆ·æ–°
- **æœ¬åœ°åŒ–**: æ—¥æœŸã€æ•°å­—ã€è´§å¸æ ¼å¼æœ¬åœ°åŒ–
- **ç”¨æˆ·åå¥½**: è¯­è¨€è®¾ç½®ä¿å­˜åˆ°ç”¨æˆ·è´¦æˆ·

---

## ğŸ›  æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| **åç«¯** | Django 5.2, Django REST Framework, PostgreSQL 16, Redis 7 |
| **å‰ç«¯** | React 19, TypeScript, Vite 7, Tailwind CSS 4, Shadcn UI |
| **å›¾è¡¨** | TanStack Table (æ•°æ®ç½‘æ ¼), React Flow (å›è·¯å›¾) |
| **å›½é™…åŒ–** | react-i18next (å‰ç«¯), Django i18n (åç«¯) |
| **å·¥å…·** | uv (Python), npm (Node.js), Docker Compose |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
OpenInstrument/
â”œâ”€â”€ backend/                    # Django REST API
â”‚   â”œâ”€â”€ config/                # Django é…ç½®
â”‚   â”œâ”€â”€ apps/
â”‚   â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒåŠŸèƒ½ (å¥åº·æ£€æŸ¥)
â”‚   â”‚   â””â”€â”€ core_engineering/  # å·¥ç¨‹æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ manage.py
â”‚   â””â”€â”€ pyproject.toml
â”œâ”€â”€ frontend/                  # React SPA
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/        # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢
â”‚   â”‚   â””â”€â”€ lib/               # å·¥å…·åº“
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ SPECIFICATION.md       # è§„æ ¼è¯´æ˜
â”‚   â”œâ”€â”€ IMPLEMENTATION.md      # å®ç°çŠ¶æ€
â”‚   â””â”€â”€ PRD.md
â””â”€â”€ docker-compose.yml
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åŸºç¡€æœåŠ¡

```bash
docker-compose up -d
```

æœåŠ¡ç«¯å£:
- PostgreSQL: **5433**
- Redis: **6380**

### 2. åç«¯è®¾ç½®

```bash
cd backend
uv sync
uv run python manage.py migrate
uv run python manage.py seed_demo_data  # å¯é€‰ï¼šåŠ è½½æ¼”ç¤ºæ•°æ®
uv run python manage.py runserver
```

### 3. å‰ç«¯è®¾ç½®

```bash
cd frontend
npm install
npm run dev
```

---

## ğŸ”— å¼€å‘åœ°å€

| æœåŠ¡ | åœ°å€ |
|------|------|
| å‰ç«¯ | http://localhost:5173 |
| åç«¯ API | http://localhost:8000/api/ |
| å·¥ç¨‹ API | http://localhost:8000/api/engineering/ |
| å¥åº·æ£€æŸ¥ | http://localhost:8000/api/health/ |
| API æ–‡æ¡£ (Swagger) | http://localhost:8000/api/docs/ |
| API æ–‡æ¡£ (ReDoc) | http://localhost:8000/api/redoc/ |

---

## ğŸ“Š SPI åŠŸèƒ½æ¨¡å—å®ç°çŠ¶æ€

| æ¨¡å— | SPI åŠŸèƒ½ | å®Œæˆåº¦ | è¯´æ˜ |
|------|----------|--------|------|
| 1.1 | Administration (ç®¡ç†æ¨¡å—) | 25% | é¡¹ç›®å±‚çº§ã€å¤šç§Ÿæˆ·ã€RBAC |
| 1.2 | Instrument Index (ä»ªè¡¨ç´¢å¼•) | 60% | Tagã€Loopã€InstrumentType |
| 1.3 | Engineering Data Editor (EDE) | 5% | é«˜æ€§èƒ½æ•°æ®ç½‘æ ¼ |
| 1.4 | Specifications (è§„æ ¼ä¹¦) | 5% | åŠ¨æ€è¡¨å•ã€PDF å¯¼å‡º |
| 1.5 | Wiring (æ¥çº¿æ¨¡å—) | 0% | I/O åˆ†é…ã€ç«¯å­åˆ†é…ã€ç”µç¼†ç®¡ç† |
| 1.6 | Loop Drawings (å›è·¯å›¾) | 0% | è‡ªåŠ¨ç”Ÿæˆã€DWG å¯¼å‡º |
| 1.7 | Rule Manager (è§„åˆ™ç®¡ç†å™¨) | 10% | ä¸šåŠ¡è§„åˆ™å¼•æ“ |
| 1.8 | Version Control (ç‰ˆæœ¬æ§åˆ¶) | 5% | å˜æ›´è¿½è¸ªã€å®¡è®¡æ—¥å¿— |
| **æ€»ä½“** | | **~17%** | |

### âœ… å·²å®Œæˆ

**åŸºç¡€æ¶æ„:**
- Django 5.2 + React 19 é¡¹ç›®æ¡†æ¶
- PostgreSQL 16 + Redis 7 æ•°æ®å­˜å‚¨
- RESTful API (CRUD + æ‰¹é‡æ“ä½œ + æœç´¢)

**æ ¸å¿ƒæ•°æ®æ¨¡å‹:**
- å·¥å‚å±‚çº§ (Plant â†’ Area â†’ Unit, MPTT æ ‘)
- ä»ªè¡¨ç±»å‹ (JSON Schema æ¨¡æ¿)
- ä»ªè¡¨ä½å· (Unit çº§å”¯ä¸€æ€§çº¦æŸ)
- æ§åˆ¶å›è·¯ç®¡ç†

### ğŸ“‹ è§„æ ¼å·²å®Œæˆ (å¾…å®ç°)

**é¡¹ç›®å±‚çº§ (v0.2.7):**
- Project â†’ Client â†’ Site â†’ Plant â†’ Area â†’ Unit å®Œæ•´å±‚çº§
- å±‚çº§ç»“æ„é…ç½® (standard/simple/custom æ¨¡æ¿)
- ä»ªè¡¨è‡ªæ§å¯¹è±¡ç»„ç»‡æ¶æ„

**æ¥çº¿ç®¡ç† (v0.2.9-v0.2.12):**
- RIO Panelã€IOCardã€IOChannel æ¨¡å‹
- I/O é€šé“åˆ†é… (AI/AO/DI/DO)
- æ¥çº¿ç®±ç«¯å­åˆ†é…
- æ¥çº¿åˆ¶å¼ (2-Wire/3-Wire/4-Wire/6-Wire)
- ä¾›ç”µç±»å‹ (24VDC/110VAC/230VAC)
- WiringPath å®Œæ•´æ¥çº¿è·¯å¾„

**RBAC ä¸é¡¹ç›®ç»„ (v0.2.15):**
- 5 çº§è§’è‰²å±‚çº§ (Administrator â†’ Guest)
- æ•°æ®æƒé™çŸ©é˜µ (æŒ‰ä¸“ä¸šåˆ’åˆ†)
- å·¥ç¨‹é¡¹ç›®ç»„ (Project Task Force) ç®¡ç†
- é¡¹ç›®ç»„æƒé™éš”ç¦»

**å‘½åè§„åˆ™ (v0.2.16):**
- 6 ç§å±‚çº§æ ¼å¼ç±»å‹
- 7 ç§é¢„è®¾å‘½åè§„åˆ™æ¨¡æ¿
- è‡ªåŠ¨ç”Ÿæˆä½å·åŠŸèƒ½
- è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ç¼–è¾‘å™¨

**å›½é™…åŒ– (v0.2.17):**
- 12 ç§è¯­è¨€æ”¯æŒ
- RTL å¸ƒå±€æ”¯æŒ (é˜¿æ‹‰ä¼¯è¯­/å¸Œä¼¯æ¥è¯­)

**å…¶ä»–åŠŸèƒ½:**
- P&ID æ•°æ®é›†æˆè§„æ ¼ (v0.2.5)
- å˜æ›´è¿½è¸ªå¢å¼º (v0.2.6)
- å‰ç«¯ UI å±‚çº§å¯¼èˆª (v0.2.10)
- å·¥è‰ºè¿‡ç¨‹æ•°æ® (v0.2.14)

### ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’ (Phase 3)

- [ ] å¤šç§Ÿæˆ·æ¶æ„å®ç° (Organization, Project, Client, Site)
- [ ] ç”¨æˆ·è®¤è¯æˆæƒå®ç°
- [ ] å‘½åè§„åˆ™å®ç°
- [ ] å®¡è®¡æ—¥å¿—å®ç°
- [ ] è®°å½•çº§é”å®š + ä¹è§‚é”å¹¶å‘æ§åˆ¶

> è¯¦ç»†çŠ¶æ€è¯·æŸ¥çœ‹ [IMPLEMENTATION.md](docs/IMPLEMENTATION.md)

---

## âš™ï¸ ç¯å¢ƒå˜é‡

`backend/.env`:

```env
DEBUG=True
SECRET_KEY=your-secret-key
DB_HOST=localhost
DB_PORT=5433
DB_NAME=openinstrument
DB_USER=openinstrument
DB_PASSWORD=openinstrument_dev_password
REDIS_URL=redis://localhost:6380/0
CORS_ALLOWED_ORIGINS=http://localhost:5173
```

---

## ğŸ“ API ç¤ºä¾‹

### è·å–å·¥å‚å±‚çº§æ ‘
```bash
GET /api/engineering/hierarchy/tree/
```

### è·å–ä»ªè¡¨ä½å·åˆ—è¡¨
```bash
GET /api/engineering/tags/
```

### åˆ›å»ºä»ªè¡¨ä½å·
```bash
POST /api/engineering/tags/
{
  "tag_number": "FT-201",
  "unit": 4,
  "instrument_type": 1,
  "service": "Feed flow measurement"
}
```

---

## ğŸ“„ License

AGPL-3.0
